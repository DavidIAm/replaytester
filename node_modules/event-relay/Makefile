NEWVERSION=$(shell node scripts/findNextBuild.js package.json)
PACKAGE=$(shell node scripts/findPackageName.js package.json)
TARBALL=$(PACKAGE)-$(NEWVERSION).tgz

all: test

test: deps
	jasmine-node tests

deps:
	npm install .

package: clean
	node scripts/setVersion.js package.json $(NEWVERSION) > package.json.new && mv package.json.new package.json
	npm pack
	mv $(TARBALL) packages/
	svn add packages/$(TARBALL)
	@echo Probably want to commit the change!
#	git add packages/$(TARBALL)
#	git commit package.json packages/$(TARBALL) -m 'add package version $(NEWVERSION)'
#	@echo Probably want to push the change (git push origin master)!

clean:
	rm -rf node_modules

.PHONY: all test deps clean 
